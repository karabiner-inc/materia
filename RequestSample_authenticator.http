############################################
# APIリクエストサンプル集
#
############################################

@url = http://localhost:4001
#@url = https://

### ユーザー仮登録
POST {{url}}/api/tmp-registration HTTP/1.1
Content-Type: application/json

 {
    "email": "tcr.yoshimura@karabiner.tech", 
    "role": "serviceuser"
  }

###仮トークン認証
@tmp_token = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJNYXRlcmlhIiwiZW1haWwiOiJ0Y3IueW9zaGltdXJhQGthcmFiaW5lci50ZWNoIiwiZXhwIjoxNTQzOTc1OTM1LCJpYXQiOjE1NDM5NzM4MzUsImlzcyI6Ik1hdGVyaWEiLCJqdGkiOiJjZDcyMDczMi01MmM0LTQyZGEtODYzNC01ODEyMGZjMzc4NDMiLCJuYmYiOjE1NDM5NzM4MzQsInN1YiI6IjMiLCJ0eXAiOiJ1c2VyX3JlZ2lzdHJhdGlvbiJ9.oktmhWQAp9dS9hZlzB0ZXdeG34trEbT3xXfiZf_yBZg

GET {{url}}/api/varidation-tmp-user HTTP/1.1
Content-Type: application/json
Authorization: {{tmp_token}}

###本登録
POST {{url}}/api/user-registration HTTP/1.1
Content-Type: application/json
Authorization: {{tmp_token}}

 {
    "name": "つちろー", 
    "password": "password"
  }

###本登録&サインイン
POST {{url}}/api/user-registration-and-sign-in HTTP/1.1
Content-Type: application/json
Authorization: {{tmp_token}}

 {
    "name": "つちろー", 
    "password": "password"
  }

###パスワード再登録申請
POST {{url}}/api/request-password-reset HTTP/1.1
Content-Type: application/json
Authorization: {{tmp_token}}

 {
    "email": "tcr.yoshimura@karabiner.tech"
  }

### PWリセットトークン認証
@pw_reset_token = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJNYXRlcmlhIiwiZW1haWwiOiJ0Y3IueW9zaGltdXJhQGthcmFiaW5lci50ZWNoIiwiZXhwIjoxNTQzOTc1OTkyLCJpYXQiOjE1NDM5NzM4OTIsImlzcyI6Ik1hdGVyaWEiLCJqdGkiOiIxZGM3MjQwNi1iZjM0LTRhYjItYTA2NC1hZTFmMjdjYmI1YWMiLCJuYmYiOjE1NDM5NzM4OTEsInN1YiI6IjMiLCJ0eXAiOiJwYXNzd29yZF9yZXNldCJ9.fER3oonKbywoW8NcelqNnpZs8yain7LFcjdqK1jQi7M

GET {{url}}/api/varidation-pw-reset HTTP/1.1
Content-Type: application/json
Authorization: {{pw_reset_token}}

###パスワード再登録
POST {{url}}/api/reset-my-password HTTP/1.1
Content-Type: application/json
Authorization: {{pw_reset_token}}

 {
    "password": "password2"
  }

### ユーザー登録(認証無し管理者向け登録機能)
POST {{url}}/api/ops/users HTTP/1.1
Content-Type: application/json

 {
    "name": "hogehoge太郎",
    "email": "admin@example.com", 
    "password": "password",
    "role": "admin"
  }

###ログイン
POST {{url}}/api/sign-in HTTP/1.1
Content-Type: application/json

{
    "email": "hogehoge@example.com", 
    "password": "hogehoge"
  }

###ログイン
POST {{url}}/api/sign-in HTTP/1.1
Content-Type: application/json

{
    "email": "fugafuga@example.com", 
    "password": "fugafuga"
  }

###ログイン(メールアドレス相違)
POST {{url}}/api/sign-in HTTP/1.1
Content-Type: application/json

{
    "email": "notexists@example.com", 
    "password": "hogehoge"
  }

###ログイン(パスワード相違)
POST {{url}}/api/sign-in HTTP/1.1
Content-Type: application/json

{
    "email": "hogehoge@example.com", 
    "password": "fugafuga"
  }

@token = Bearer eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJTZXJ2aWNleCIsImVtYWlsIjoiaG9nZWhvZ2VAZXhhbXBsZS5jb20iLCJleHAiOjE1NDA4MDUwMjcsImlhdCI6MTU0MDgwNDQyNywiaXNzIjoiU2VydmljZXgiLCJqdGkiOiIyMWM4MmNkMy01ZmRjLTRkYzItYjE4MS1kZWY4OTNhZmI4YmEiLCJuYmYiOjE1NDA4MDQ0MjYsInN1YiI6IjEiLCJ0eXAiOiJhY2Nlc3MifQ.H6sMFoAb5FW27MguIdfqEgC6yMBGLeNeehsEjutKulBL0PMlFBIXruPaCa-Nf_9sXI4Cd-KSmsTsQR5yEL7stA

###認証チェック

GET {{url}}/api/auth-check HTTP/1.1
Content-Type: application/json
Authorization: {{token}}

###トークンリフレッシュ

POST {{url}}/api/refresh HTTP/1.1
Content-Type: application/json

{
  "refresh_token": "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJTZXJ2aWNleCIsImVtYWlsIjoiaG9nZWhvZ2VAZXhhbXBsZS5jb20iLCJleHAiOjE1NDA4MDUwMjcsImlhdCI6MTU0MDgwNDQyNywiaXNzIjoiU2VydmljZXgiLCJqdGkiOiIyMWM4MmNkMy01ZmRjLTRkYzItYjE4MS1kZWY4OTNhZmI4YmEiLCJuYmYiOjE1NDA4MDQ0MjYsInN1YiI6IjEiLCJ0eXAiOiJhY2Nlc3MifQ.H6sMFoAb5FW27MguIdfqEgC6yMBGLeNeehsEjutKulBL0PMlFBIXruPaCa-Nf_9sXI4Cd-KSmsTsQR5yEL7stA"
}


###ユーザー情報照会(一般ユーザー用)
GET {{url}}/api/user HTTP/1.1
Content-Type: application/json
Authorization: {{token}}

###ユーザー一覧照会(オペレーター用)
GET {{url}}/api/ops/users HTTP/1.1
Content-Type: application/json
Authorization: {{token}}

###ユーザー情報照会(オペレーター用)
GET {{url}}/api/ops/users/2 HTTP/1.1
Content-Type: application/json
Authorization: {{token}}

###権限情報一覧照会
GET {{url}}/api/ops/grants HTTP/1.1
Content-Type: application/json
Authorization: {{token}}

###権限情報照会
GET {{url}}/api/ops/grants/4 HTTP/1.1
Content-Type: application/json
Authorization: {{token}}

###ロール指定の権限照会
POST {{url}}/api/grant HTTP/1.1
Content-Type: application/json
Authorization: {{token}}

{
  "role": "admin"
}


###ログアウト
POST {{url}}/api/sign-out HTTP/1.1
Content-Type: application/json
Authorization: {{token}}
